import{r as i,j as e,b as k,c as w,e as P}from"./index-BKFekqWS.js";function D(){const[m,a]=i.useState("camera"),[c,x]=i.useState(null),[r,y]=i.useState(null),[g,d]=i.useState("Loading address..."),[o,u]=i.useState({sector:"",severity:"",description:""}),l=i.useRef(null),p=i.useRef(null);i.useEffect(()=>(b(),N(),()=>v()),[]);async function b(){try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});l.current&&(l.current.srcObject=t,p.current=t)}catch(t){console.error("Camera error:",t),alert("Camera access denied. Please enable camera permissions.")}}function v(){p.current&&p.current.getTracks().forEach(t=>t.stop())}async function N(){if(!navigator.geolocation){d("Geolocation not supported");return}navigator.geolocation.getCurrentPosition(async t=>{const{latitude:s,longitude:n,accuracy:h}=t.coords;y({lat:s,lng:n,accuracy:h});try{const j=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${s}&lon=${n}&format=json`)).json();d(j.display_name||`${s}, ${n}`)}catch{d(`${s.toFixed(4)}, ${n.toFixed(4)}`)}},t=>{console.error("GPS error:",t),d("Location unavailable")},{enableHighAccuracy:!0,timeout:1e4})}function S(){if(!l.current||!r){alert("Waiting for GPS lock...");return}const t=document.createElement("canvas");t.width=l.current.videoWidth,t.height=l.current.videoHeight;const s=t.getContext("2d");s.drawImage(l.current,0,0),s.font="bold 24px Inter, sans-serif",s.fillStyle="white",s.strokeStyle="black",s.lineWidth=4;const n=g.substring(0,50);s.strokeText(n,20,40),s.fillText(n,20,40);const h=`${r.lat.toFixed(4)}, ${r.lng.toFixed(4)}`;s.strokeText(h,t.width-250,40),s.fillText(h,t.width-250,40);const f=new Date().toLocaleString("en-IN");s.strokeText(f,t.width-300,t.height-20),s.fillText(f,t.width-300,t.height-20);const j=t.toDataURL("image/jpeg",.9);x(j),v(),a("form")}function C(){x(null),a("camera"),b()}async function R(){if(!o.sector||!o.severity){alert("Please select sector and severity");return}try{const t={title:`${o.sector} - ${o.severity}`,description:o.description,sector:o.sector,severity:o.severity,photo:c,location:{lat:r.lat,lng:r.lng,address:g},rawGps:r,createdAt:new Date().toISOString()};await k.createIssue(t),a("success")}catch(t){console.error("Submit error:",t),alert("Failed to submit report. Please try again.")}}return m==="camera"?e.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-4 text-center",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Report Issue"}),e.jsx("p",{className:"text-sm opacity-90",children:"Capture photo with GPS"})]}),e.jsxs("div",{className:"flex-1 relative bg-black",children:[e.jsx("video",{ref:l,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-2 rounded text-sm",children:r?e.jsxs("span",{children:["ðŸ“ GPS: Â±",r.accuracy.toFixed(0),"m"]}):e.jsx("span",{children:"ðŸ“ Acquiring GPS..."})})]}),e.jsx("div",{className:"p-6 bg-white",children:e.jsx("button",{onClick:S,disabled:!r,className:"w-full bg-blue-600 text-white py-4 rounded-lg text-lg font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed",children:"ðŸ“· CAPTURE"})})]}):m==="form"?e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-blue-600 text-white p-4 text-center",children:e.jsx("h1",{className:"text-xl font-bold",children:"Describe Issue"})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg overflow-hidden shadow",children:e.jsx("img",{src:c,alt:"Captured",className:"w-full"})}),e.jsx("button",{onClick:C,className:"w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold",children:"â† Retake Photo"}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow",children:[e.jsx("label",{className:"block font-semibold mb-3",children:"What type of issue?"}),e.jsx("div",{className:"space-y-2",children:["Roads","Water","Drainage","Lighting","Waste"].map(t=>e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"sector",value:t,onChange:s=>u({...o,sector:s.target.value}),className:"w-5 h-5"}),e.jsx("span",{className:"text-2xl",children:t==="Roads"?"ðŸ›£ï¸":t==="Water"?"ðŸ’§":t==="Drainage"?"ðŸš°":t==="Lighting"?"ðŸ’¡":"ðŸ—‘ï¸"}),e.jsx("span",{className:"font-medium",children:t})]},t))})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow",children:[e.jsx("label",{className:"block font-semibold mb-3",children:"How severe is it?"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{label:"Minor",size:"text-sm"},{label:"Moderate",size:"text-base"},{label:"Severe",size:"text-lg"},{label:"Critical",size:"text-xl"}].map(({label:t,size:s})=>e.jsxs("label",{className:"flex items-center justify-center gap-2 p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500",children:[e.jsx("input",{type:"radio",name:"severity",value:t,onChange:n=>u({...o,severity:n.target.value}),className:"w-5 h-5"}),e.jsx("span",{className:`font-semibold ${s}`,children:t})]},t))})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow",children:[e.jsx("label",{className:"block font-semibold mb-3",children:"Describe (optional)"}),e.jsx("textarea",{value:o.description,onChange:t=>u({...o,description:t.target.value}),placeholder:"E.g., Large pothole near main gate",maxLength:500,rows:4,className:"w-full border rounded-lg p-3 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[o.description.length," / 500 characters"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"ðŸ“ Location Verified"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:g}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Lat: ",r==null?void 0:r.lat.toFixed(6)," | Lng: ",r==null?void 0:r.lng.toFixed(6)," | Â±",r==null?void 0:r.accuracy.toFixed(0),"m"]})]}),e.jsx("button",{onClick:R,className:"w-full bg-blue-600 text-white py-4 rounded-lg text-lg font-bold shadow-lg",children:"SUBMIT REPORT"}),e.jsx("p",{className:"text-center text-sm text-gray-600",children:"Your report will be reviewed within 24 hours"})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 text-center max-w-md shadow-lg",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âœ“"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Report Submitted!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your issue has been recorded and will be reviewed by the municipal team."}),e.jsx("button",{onClick:()=>{a("camera"),x(null),u({sector:"",severity:"",description:""}),b()},className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold",children:"Report Another Issue"})]})})}class E extends w.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,c){console.error("Citizen App Crash:",a,c)}render(){var a;return this.state.hasError?e.jsxs("div",{style:{padding:20,color:"white",background:"#111"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsx("pre",{children:(a=this.state.error)==null?void 0:a.toString()})]}):this.props.children}}P.createRoot(document.getElementById("root")).render(e.jsx(w.StrictMode,{children:e.jsx(E,{children:e.jsx(D,{})})}));
